<!DOCTYPE html>
<html lang="zh-cn">
    <!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1">
  <meta name="color-scheme" content="light dark">
  
  <title>2022复现 - 云之君&#39;s Blog</title>
  
    <link rel="shortcut icon" href="/theme-img/fav/favicon.png">
  
  
    <link rel='manifest' href='/manifest.json'>
  

  
<link rel="stylesheet" href="/css/var.css">

  
<link rel="stylesheet" href="/css/main.css">

  
<link rel="stylesheet" href="/css/typography.css">

  
<link rel="stylesheet" href="/css/code-highlighting.css">

  
<link rel="stylesheet" href="/css/components.css">

  
<link rel="stylesheet" href="/css/nav.css">

  
<link rel="stylesheet" href="/css/paginator.css">

  
<link rel="stylesheet" href="/css/footer.css">

  
<link rel="stylesheet" href="/css/post-list.css">

  
<link rel="stylesheet" href="/css/waline.css">

  
  
  
<link rel="stylesheet" href="/css/post.css">

  

  
    
<script src="https://cdn.jsdelivr.net/npm/js-cookie@rc/dist/js.cookie.min.js"></script>
 
  

  
<meta name="generator" content="Hexo 5.4.2"></head>
    <body data-color-scheme="auto">
        <nav id="theme-nav">
    <div class="inner">
        <a class="title" href="/">云之君&#39;s Blog</a>
        <div class="nav-arrow"></div>
        <div class="nav-items">
            <a class="nav-item nav-item-home" href="/">主页</a>
            
            
            <a class="nav-item" href="/friends">Friends</a>
            
            
            
            <a class="nav-item" href="/CTF">CTF</a>
            
            
            
            <a class="nav-item" href="/Learn">Learn</a>
            
            
            
            <a class="nav-item" href="/Dairy">Dairy</a>
            
            
            
            <a class="nav-item" href="/Alkaid">Alkaid</a>
            
            
            
            <a class="nav-item nav-item-github nav-item-icon" href="https://github.com/YunZh1Jun" target="_blank">&nbsp;</a>
            
            
        </div>
    </div>
</nav>
        <article class="post">
    <div class="meta">
        
        <div class="date" id="date">
            
            
            
            
            
            
            
            
            
            <span>September</span>
            
            
            
            
            <span>18,</span>
            <span>2022</span>
        </div>
        

        <h2 class="title">2022复现</h2>
    </div>

    <div class="divider"></div>

    <div class="content">
        <p>记录一些2022年乱七八糟的比赛的WP和复现。</p>
<span id="more"></span>

<h2 id="第五空间"><a href="#第五空间" class="headerlink" title="第五空间"></a>第五空间</h2><h3 id="wb"><a href="#wb" class="headerlink" title="wb"></a>wb</h3><p>这其实是个密码题，比赛的时候我给dbt👴在这题打下手，就顺便写一下逆向的部分，方便密码👴们复现这道题。</p>
<p>输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">This is an highly obfuscated whitebox ECDSA implementation (on an certain standard elliptic curve)!</span><br><span class="line">E.g. the sig of a message with empty hash is</span><br><span class="line">0xBBDFAC1809250A2BB9415225F7C548CF8C03A5E100F95D52A4AA27F42A2F0FBE, 0x615ED230E3DCEF9712DC86AFE1C33F818EF1BA79212DA3E6D522D41D4C5D6C45 </span><br><span class="line">the flag is the ascii decoding of the private key in big endian</span><br><span class="line">Hint: No need to do (much) reverse engineering!</span><br></pre></td></tr></table></figure>

<p>main函数：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">main</span><span class="params">(<span class="type">int</span> a1, <span class="type">char</span> **a2, <span class="type">char</span> **a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> v4[<span class="number">64</span>]; <span class="comment">// [rsp+0h] [rbp-70h] BYREF</span></span><br><span class="line">  __int64 v5[<span class="number">5</span>]; <span class="comment">// [rsp+40h] [rbp-30h] BYREF</span></span><br><span class="line">  <span class="type">int</span> j; <span class="comment">// [rsp+68h] [rbp-8h]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+6Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  v5[<span class="number">0</span>] = <span class="number">0LL</span>;</span><br><span class="line">  v5[<span class="number">1</span>] = <span class="number">0LL</span>;</span><br><span class="line">  v5[<span class="number">2</span>] = <span class="number">0LL</span>;</span><br><span class="line">  v5[<span class="number">3</span>] = <span class="number">0LL</span>;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;This is an highly obfuscated whitebox ECDSA implementation (on an certain standard elliptic curve)!&quot;</span>);</span><br><span class="line">  sub_404565(v4, v5);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;E.g. the sig of a message with empty hash is\n0x&quot;</span>);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">31</span>; ++i )</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%02X&quot;</span>, (<span class="type">unsigned</span> __int8)v4[i]);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;, 0x&quot;</span>);</span><br><span class="line">  <span class="keyword">for</span> ( j = <span class="number">32</span>; j &lt;= <span class="number">63</span>; ++j )</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%02X&quot;</span>, (<span class="type">unsigned</span> __int8)v4[j]);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;\nthe flag is the ascii decoding of the private key in big endian&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Hint: No need to do (much) reverse engineering!&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>v5赋0，sub_404565向v4里写了一堆东西然后打印出来，v4不会影响结果，修改v5的值会得到不同的结果。</p>
<blockquote>
<p>至于怎么修改v5？直接丢给队里的逆向手吧hhhhhhh</p>
</blockquote>
<p>sub_404565里做了严重的混淆，无法逆向，只有两个函数能看。这两个函数分别在混淆的最初和最后调用，相关内容我已经写在注释里。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">sub_409980</span><span class="params">(__int64 a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> v2[<span class="number">8</span>]; <span class="comment">// [rsp+18h] [rbp-38h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v3[<span class="number">16</span>]; <span class="comment">// [rsp+20h] [rbp-30h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v4[<span class="number">16</span>]; <span class="comment">// [rsp+30h] [rbp-20h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v5[<span class="number">16</span>]; <span class="comment">// [rsp+40h] [rbp-10h] BYREF</span></span><br><span class="line"></span><br><span class="line">  __gmpz_init(v5);</span><br><span class="line">  __gmpz_import(v5, <span class="number">32LL</span>, <span class="number">1LL</span>, <span class="number">1LL</span>, <span class="number">0LL</span>, <span class="number">0LL</span>, a1);<span class="comment">// v5=0</span></span><br><span class="line">  __gmpz_init_set_str(v4, off_410E28, <span class="number">16LL</span>);    <span class="comment">// v4=8b98a63042f8d2ee616e680ab504de9b2e8a8effb4b413f85be9ba360b58e795</span></span><br><span class="line">  __gmpz_init_set_str(v3, <span class="string">&quot;ffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551&quot;</span>, <span class="number">16LL</span>);</span><br><span class="line">  __gmpz_mul(v5, v5, v4);                       <span class="comment">// v5*=v4</span></span><br><span class="line">  __gmpz_mod(v5, v5, v3);                       <span class="comment">// v5%=v3</span></span><br><span class="line">  <span class="keyword">return</span> __gmpz_export(a1, v2, <span class="number">1LL</span>, <span class="number">1LL</span>, <span class="number">0LL</span>, <span class="number">0LL</span>, v5);</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">sub_409A5F</span><span class="params">(__int64 a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> v2[<span class="number">8</span>]; <span class="comment">// [rsp+18h] [rbp-38h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v3[<span class="number">16</span>]; <span class="comment">// [rsp+20h] [rbp-30h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v4[<span class="number">16</span>]; <span class="comment">// [rsp+30h] [rbp-20h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v5[<span class="number">16</span>]; <span class="comment">// [rsp+40h] [rbp-10h] BYREF</span></span><br><span class="line"></span><br><span class="line">  __gmpz_init(v5);</span><br><span class="line">  __gmpz_import(v5, <span class="number">32LL</span>, <span class="number">1LL</span>, <span class="number">1LL</span>, <span class="number">0LL</span>, <span class="number">0LL</span>, a1 + <span class="number">32</span>);</span><br><span class="line">  __gmpz_init_set_str(v4, off_410E30, <span class="number">16LL</span>);    <span class="comment">// v4=8f6f7a2e53c0377e9afb357a510371ea7811df0ac47fb92b92f6baca90ebc282</span></span><br><span class="line">  __gmpz_init_set_str(v3, <span class="string">&quot;ffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551&quot;</span>, <span class="number">16LL</span>);</span><br><span class="line">  __gmpz_mul(v5, v5, v4);</span><br><span class="line">  __gmpz_mod(v5, v5, v3);</span><br><span class="line">  <span class="keyword">return</span> __gmpz_export(a1 + <span class="number">32</span>, v2, <span class="number">1LL</span>, <span class="number">1LL</span>, <span class="number">0LL</span>, <span class="number">0LL</span>, v5);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>dbt让我修改v5的值，运行程序得到以下数据：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">v5 = <span class="number">1</span></span><br><span class="line"><span class="comment">//output:0xBBDFAC1809250A2BB9415225F7C548CF8C03A5E100F95D52A4AA27F42A2F0FBE, 0x49225E3C59E87FA62AEB73FD50239A6E03278B96A11319D54624AF8714F2C989</span></span><br><span class="line">v5 = <span class="number">2</span></span><br><span class="line"><span class="comment">//output:0xBBDFAC1809250A2BB9415225F7C548CF8C03A5E100F95D52A4AA27F42A2F0FBE, 0x30E5EA47CFF40FB542FA614ABE83F55A775D5CB420F88FC3B7268AF0DD8826CD</span></span><br></pre></td></tr></table></figure>

<p>最终脚本（来自dbt👴）：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">n =<span class="number">0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551</span></span><br><span class="line">k = <span class="number">0x8b98a63042f8d2ee616e680ab504de9b2e8a8effb4b413f85be9ba360b58e795</span></span><br><span class="line">k_inv = <span class="number">0x8f6f7a2e53c0377e9afb357a510371ea7811df0ac47fb92b92f6baca90ebc282</span></span><br><span class="line"><span class="keyword">assert</span> k * k_inv % n == <span class="number">1</span></span><br><span class="line"></span><br><span class="line">r,s   = <span class="number">0xBBDFAC1809250A2BB9415225F7C548CF8C03A5E100F95D52A4AA27F42A2F0FBE</span>, <span class="number">0x615ED230E3DCEF9712DC86AFE1C33F818EF1BA79212DA3E6D522D41D4C5D6C45</span> </span><br><span class="line">r1,s1 = <span class="number">0xBBDFAC1809250A2BB9415225F7C548CF8C03A5E100F95D52A4AA27F42A2F0FBE</span>, <span class="number">0x49225E3C59E87FA62AEB73FD50239A6E03278B96A11319D54624AF8714F2C989</span></span><br><span class="line">r2,s2 = <span class="number">0xBBDFAC1809250A2BB9415225F7C548CF8C03A5E100F95D52A4AA27F42A2F0FBE</span>, <span class="number">0x30E5EA47CFF40FB542FA614ABE83F55A775D5CB420F88FC3B7268AF0DD8826CD</span></span><br><span class="line"><span class="keyword">assert</span> ((s1*<span class="number">0</span>-s*<span class="number">1</span>)%n == (s2*<span class="number">1</span>-s1*<span class="number">2</span>) %n)</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(long_to_bytes((s1*<span class="number">0</span>-s*<span class="number">1</span>)%n * inverse(r*(s-s1),n) % n))</span><br></pre></td></tr></table></figure>

<h3 id="re2"><a href="#re2" class="headerlink" title="re2"></a>re2</h3><p>mips，ghidra可冲</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">undefined8 <span class="title function_">move</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> check;</span><br><span class="line">  <span class="type">int</span> input_idx;</span><br><span class="line">  <span class="type">char</span> input [<span class="number">528</span>];</span><br><span class="line">  undefined *local_18;</span><br><span class="line">  <span class="type">char</span> this_c;</span><br><span class="line">  </span><br><span class="line">  local_18 = &amp;_mips_gp0_value;</span><br><span class="line">  input_idx = <span class="number">0</span>;</span><br><span class="line">  input[<span class="number">0</span>] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">  input[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">memset</span>(input + <span class="number">2</span>,<span class="number">0</span>,<span class="number">0x1fe</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;input: &quot;</span>);</span><br><span class="line">  __isoc99_scanf(&amp;DAT_120001878,input);</span><br><span class="line">  <span class="keyword">while</span>( <span class="literal">true</span> ) &#123;</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">      check = <span class="number">0</span>;</span><br><span class="line">      find();</span><br><span class="line">      this_c = input[input_idx];</span><br><span class="line">      <span class="keyword">if</span> (this_c == <span class="string">&#x27;w&#x27;</span>) &#123;</span><br><span class="line">        check = Up();</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (this_c &lt; <span class="string">&#x27;x&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (this_c == <span class="string">&#x27;s&#x27;</span>) &#123;</span><br><span class="line">          check = Down();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (this_c &lt; <span class="string">&#x27;t&#x27;</span>) &#123;</span><br><span class="line">          <span class="keyword">if</span> (this_c == <span class="string">&#x27;d&#x27;</span>) &#123;</span><br><span class="line">            check = Right();</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">else</span> <span class="keyword">if</span> (this_c &lt; <span class="string">&#x27;e&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (this_c == <span class="string">&#x27;\x1b&#x27;</span>) &#123;</span><br><span class="line">              <span class="keyword">return</span> <span class="number">0xffffffffffffffff</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (this_c == <span class="string">&#x27;a&#x27;</span>) &#123;</span><br><span class="line">              check = Left();</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      input_idx = input_idx + <span class="number">1</span>;</span><br><span class="line">    &#125; <span class="keyword">while</span> (check != <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span> (level == <span class="number">2</span>) <span class="keyword">break</span>;</span><br><span class="line">    level = level + <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;flag is ctf&#123;md5(your input)&#125;&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>数据里找地图，注意是word类型的</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">map</span> = [<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">4</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">4</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">4</span>, <span class="number">0</span>, <span class="number">0</span>]</span><br></pre></td></tr></table></figure>

<p>打印出来迷宫手动走即可。<br><del>泪目，这么简单的签到题真的不多了</del></p>
<h3 id="Universal"><a href="#Universal" class="headerlink" title="Universal"></a>Universal</h3><p>这题就是纯调试。。。没任何技巧。。。对着trace边看边调试，抽了3天的空终于调出来了，这对我这个调试菜鸡来说还是太艰难了😭😭😭<br>感觉这种东西还是要多练啊，做熟练了，比赛遇到的时候就不会紧张了<br>但是这个题莫名其妙的……好像没人写这个题的wp……（还是自己硬着头皮嗯啃汇编了……  <del>但还是想吐槽汇编真难看</del><br>现在面对着trace出来1w+行我终于也能说</p>
<blockquote>
<p>区区1w行（（（  <del>这都小场面</del></p>
</blockquote>
<p>泪目</p>
<p>ctrl s找data段，往下翻找到密文<code>unk_415100</code>，找交叉引用，反编译到<code>sub_402747</code>，主要的加密逻辑：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ( sub_40AE50() == <span class="number">32</span> )</span><br><span class="line">&#123;</span><br><span class="line">  v7 = <span class="number">0</span>;</span><br><span class="line">  sub_40553C(v6, &amp;v14);</span><br><span class="line">  sub_40553C(v8, &amp;v14);</span><br><span class="line">  sub_40553C(v9, &amp;v14);</span><br><span class="line">  sub_40553C(v10, &amp;v14);</span><br><span class="line">  v11 = sub_405432();</span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">  &#123;</span><br><span class="line">    v12 = v7++;</span><br><span class="line">    *((_BYTE *)v15 + (v12 &amp; <span class="number">0x1F</span>)) = v11 ^ ~(*((_BYTE *)v15 + (v12 &amp; <span class="number">0x1F</span>)) ^ *((_BYTE *)v15 + (v7 &amp; <span class="number">0x1F</span>)));</span><br><span class="line">    v11 = sub_405432() ^ <span class="number">0xA5</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">while</span> ( v7 != <span class="number">64</span> );</span><br><span class="line">  <span class="keyword">if</span> ( !(<span class="type">unsigned</span> <span class="type">int</span>)sub_40A530(v13, <span class="number">0x20</span>ui64) )</span><br><span class="line">    sub_405595();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>用<code>sub_40553C</code>加密了4次，然后用<code>sub_405432</code>加密，最后<code>sub_40A530</code>和密文对比。<br>可以知道flag长度是32，调试选项Paramenters加上一个长度为32的字符串就可以正常运行。此后下断点去trace，看trace去分析。</p>
<p>trace看逻辑，调试看内存。还原出来的逻辑如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> struct <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="built_in">input</span> = [<span class="number">0x33323130</span>, <span class="number">0x37363534</span>, <span class="number">0x31303938</span>, <span class="number">0x35343332</span>,<span class="number">0x39383736</span>, <span class="number">0x33323130</span>, <span class="number">0x37363534</span>, <span class="number">0x31303938</span>]</span><br><span class="line">xor0 = [<span class="number">0xDEADBEEF</span>, <span class="number">0x9E3779B9</span>, <span class="number">0xC6EF3720</span>, <span class="number">0xBEEFDEED</span>, <span class="number">0xDEADBEEF</span>, <span class="number">0x9E3779B9</span>, <span class="number">0xC6EF3720</span>, <span class="number">0xBEEFDEED</span>, <span class="number">0x33323130</span>, <span class="number">0x37363534</span>, <span class="number">0x31303938</span>, <span class="number">0x35343332</span>,<span class="number">0x39383736</span>, <span class="number">0x33323130</span>, <span class="number">0x37363534</span>, <span class="number">0x31303938</span>]</span><br><span class="line">xor1 = [<span class="number">3</span>, <span class="number">0xF</span>, <span class="number">0xE</span>, <span class="number">0xA</span>, <span class="number">4</span>, <span class="number">7</span>, <span class="number">0</span>, <span class="number">9</span>, <span class="number">1</span>, <span class="number">0xD</span>, <span class="number">6</span>, <span class="number">2</span>, <span class="number">5</span>, <span class="number">0xC</span>, <span class="number">0xB</span>, <span class="number">8</span>]</span><br><span class="line">xor2 = [<span class="number">3</span>, <span class="number">0xA</span>, <span class="number">5</span>, <span class="number">8</span>, <span class="number">4</span>, <span class="number">0xB</span>, <span class="number">0xD</span>, <span class="number">0xC</span>, <span class="number">7</span>, <span class="number">6</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">9</span>, <span class="number">0xE</span>, <span class="number">0xF</span>]</span><br><span class="line">xor3 = [<span class="number">1</span>, <span class="number">0</span>, <span class="number">9</span>, <span class="number">0xB</span>, <span class="number">0xF</span>, <span class="number">5</span>, <span class="number">0xC</span>, <span class="number">4</span>, <span class="number">0xE</span>, <span class="number">0xD</span>, <span class="number">0xA</span>, <span class="number">8</span>, <span class="number">2</span>, <span class="number">6</span>, <span class="number">3</span>, <span class="number">7</span>]</span><br><span class="line">xor4 = [<span class="number">0xB</span>, <span class="number">3</span>, <span class="number">0xE</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">1</span>, <span class="number">7</span>, <span class="number">0</span>, <span class="number">0xD</span>, <span class="number">0xC</span>, <span class="number">4</span>, <span class="number">8</span>, <span class="number">2</span>, <span class="number">0xA</span>, <span class="number">0xF</span>]</span><br><span class="line">xor5 = [<span class="number">0xD</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">5</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">6</span>, <span class="number">0xA</span>, <span class="number">7</span>, <span class="number">0xB</span>, <span class="number">0xC</span>, <span class="number">3</span>, <span class="number">0xE</span>, <span class="number">0xF</span>]</span><br><span class="line">xor6 = [<span class="number">0xF</span>, <span class="number">0xC</span>, <span class="number">0xA</span>, <span class="number">6</span>, <span class="number">0</span>, <span class="number">9</span>, <span class="number">5</span>, <span class="number">0xE</span>, <span class="number">2</span>, <span class="number">0xB</span>, <span class="number">4</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">1</span>, <span class="number">0xD</span>, <span class="number">3</span>]</span><br><span class="line">xor7 = [<span class="number">0xD</span>, <span class="number">2</span>, <span class="number">9</span>, <span class="number">0</span>, <span class="number">0xF</span>, <span class="number">3</span>, <span class="number">0xA</span>, <span class="number">0xB</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">0xE</span>, <span class="number">7</span>, <span class="number">0xC</span>, <span class="number">1</span>, <span class="number">8</span>]</span><br><span class="line">xor8 = [<span class="number">4</span>, <span class="number">0xE</span>, <span class="number">0</span>, <span class="number">0xF</span>, <span class="number">9</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">0xD</span>, <span class="number">5</span>, <span class="number">1</span>, <span class="number">0xC</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">0xA</span>, <span class="number">0xB</span>, <span class="number">6</span>]</span><br><span class="line">idx = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">7</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encode1</span>(<span class="params">i0,i1</span>):</span><br><span class="line">	tmp = <span class="built_in">input</span>[i0] ^ xor0[<span class="number">0</span>] ^ <span class="built_in">input</span>[i1]</span><br><span class="line">	xor0_idx = <span class="number">30</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">31</span>):</span><br><span class="line">		key = (xor1[(tmp&gt;&gt;<span class="number">0x1c</span>)&amp;<span class="number">0xf</span>]&lt;&lt;<span class="number">28</span>)|(xor2[(tmp&gt;&gt;<span class="number">0x18</span>)&amp;<span class="number">0xf</span>]&lt;&lt;<span class="number">24</span>)|(xor3[(tmp&gt;&gt;<span class="number">0x14</span>)&amp;<span class="number">0xf</span>]&lt;&lt;<span class="number">20</span>)|(xor4[(tmp&gt;&gt;<span class="number">0x10</span>)&amp;<span class="number">0xf</span>]&lt;&lt;<span class="number">16</span>)|(xor5[(tmp&gt;&gt;<span class="number">0xc</span>)&amp;<span class="number">0xf</span>]&lt;&lt;<span class="number">12</span>)|(xor6[(tmp&gt;&gt;<span class="number">0x8</span>)&amp;<span class="number">0xf</span>]&lt;&lt;<span class="number">8</span>)|(xor7[(tmp&gt;&gt;<span class="number">0x4</span>)&amp;<span class="number">0xf</span>]&lt;&lt;<span class="number">4</span>)|(xor8[(tmp)&amp;<span class="number">0xf</span>])</span><br><span class="line">		<span class="built_in">input</span>[i1] = <span class="built_in">input</span>[i0]</span><br><span class="line">		tmp = key ^ xor0[idx[xor0_idx]] ^ <span class="built_in">input</span>[i1]</span><br><span class="line">		<span class="built_in">input</span>[i0] = key</span><br><span class="line">		xor0_idx -= <span class="number">1</span></span><br><span class="line">	key = (xor1[(tmp&gt;&gt;<span class="number">0x1c</span>)&amp;<span class="number">0xf</span>]&lt;&lt;<span class="number">28</span>)|(xor2[(tmp&gt;&gt;<span class="number">0x18</span>)&amp;<span class="number">0xf</span>]&lt;&lt;<span class="number">24</span>)|(xor3[(tmp&gt;&gt;<span class="number">0x14</span>)&amp;<span class="number">0xf</span>]&lt;&lt;<span class="number">20</span>)|(xor4[(tmp&gt;&gt;<span class="number">0x10</span>)&amp;<span class="number">0xf</span>]&lt;&lt;<span class="number">16</span>)|(xor5[(tmp&gt;&gt;<span class="number">0xc</span>)&amp;<span class="number">0xf</span>]&lt;&lt;<span class="number">12</span>)|(xor6[(tmp&gt;&gt;<span class="number">0x8</span>)&amp;<span class="number">0xf</span>]&lt;&lt;<span class="number">8</span>)|(xor7[(tmp&gt;&gt;<span class="number">0x4</span>)&amp;<span class="number">0xf</span>]&lt;&lt;<span class="number">4</span>)|(xor8[(tmp)&amp;<span class="number">0xf</span>])</span><br><span class="line">	<span class="built_in">input</span>[i1] = key</span><br><span class="line"></span><br><span class="line">encode1(<span class="number">0</span>,<span class="number">3</span>)</span><br><span class="line">encode1(<span class="number">1</span>,<span class="number">2</span>)</span><br><span class="line">encode1(<span class="number">4</span>,<span class="number">6</span>)</span><br><span class="line">encode1(<span class="number">5</span>,<span class="number">7</span>)</span><br><span class="line"></span><br><span class="line">input_byte = []</span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">input</span>:</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> pack(<span class="string">&#x27;&lt;I&#x27;</span>,k):</span><br><span class="line">		input_byte.append(i)</span><br><span class="line"></span><br><span class="line">what = (input_byte[<span class="number">0</span>] + input_byte[-<span class="number">1</span>]) &amp; <span class="number">0xff</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">	input_byte[i] = what ^ (input_byte[i] ^ input_byte[(i+<span class="number">1</span>)&amp;<span class="number">0x1f</span>]) ^ <span class="number">0xff</span></span><br><span class="line">	what += input_byte[i]</span><br><span class="line">	what ^= <span class="number">0xa5</span></span><br><span class="line">	what &amp;= <span class="number">0xff</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">	input_byte[i] = what ^ (input_byte[i] ^ input_byte[(i+<span class="number">1</span>)&amp;<span class="number">0x1f</span>]) ^ <span class="number">0xff</span></span><br><span class="line">	what += input_byte[i]</span><br><span class="line">	what ^= <span class="number">0xa5</span></span><br><span class="line">	what &amp;= <span class="number">0xff</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">	<span class="built_in">print</span>(<span class="built_in">hex</span>(input_byte[i]),end=<span class="string">&#x27;,&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>逆着去写解密脚本脚本即可。<br>注意decode2里面的what值是不可知的，所以只能爆破，可以通过限制what等于<code>(input_byte[0] + input_byte[-1]) &amp; 0xff</code>来减少解的情况。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> struct <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">input_enc = [<span class="number">0xC2</span>, <span class="number">0x3A</span>, <span class="number">0x86</span>, <span class="number">0xC1</span>, <span class="number">0x44</span>, <span class="number">0x07</span>, <span class="number">0x13</span>, <span class="number">0x0C</span>, <span class="number">0x7B</span>, <span class="number">0xBE</span>, <span class="number">0x1A</span>, <span class="number">0x6D</span>, <span class="number">0xCB</span>, <span class="number">0xFA</span>, <span class="number">0x26</span>, <span class="number">0x99</span>, <span class="number">0x62</span>, <span class="number">0x7C</span>, <span class="number">0x82</span>, <span class="number">0x66</span>, <span class="number">0x9F</span>, <span class="number">0x1C</span>, <span class="number">0xD9</span>, <span class="number">0x99</span>, <span class="number">0x44</span>, <span class="number">0xC3</span>, <span class="number">0xB7</span>, <span class="number">0x1D</span>, <span class="number">0x67</span>, <span class="number">0x3C</span>, <span class="number">0x7B</span>, <span class="number">0x80</span>]</span><br><span class="line">decode_1 = []</span><br><span class="line">xor0 = [<span class="number">0xDEADBEEF</span>, <span class="number">0x9E3779B9</span>, <span class="number">0xC6EF3720</span>, <span class="number">0xBEEFDEED</span>, <span class="number">0xDEADBEEF</span>, <span class="number">0x9E3779B9</span>, <span class="number">0xC6EF3720</span>, <span class="number">0xBEEFDEED</span>, <span class="number">0x33323130</span>, <span class="number">0x37363534</span>, <span class="number">0x31303938</span>, <span class="number">0x35343332</span>,<span class="number">0x39383736</span>, <span class="number">0x33323130</span>, <span class="number">0x37363534</span>, <span class="number">0x31303938</span>]</span><br><span class="line">xor1 = [<span class="number">3</span>, <span class="number">0xF</span>, <span class="number">0xE</span>, <span class="number">0xA</span>, <span class="number">4</span>, <span class="number">7</span>, <span class="number">0</span>, <span class="number">9</span>, <span class="number">1</span>, <span class="number">0xD</span>, <span class="number">6</span>, <span class="number">2</span>, <span class="number">5</span>, <span class="number">0xC</span>, <span class="number">0xB</span>, <span class="number">8</span>]</span><br><span class="line">xor2 = [<span class="number">3</span>, <span class="number">0xA</span>, <span class="number">5</span>, <span class="number">8</span>, <span class="number">4</span>, <span class="number">0xB</span>, <span class="number">0xD</span>, <span class="number">0xC</span>, <span class="number">7</span>, <span class="number">6</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">9</span>, <span class="number">0xE</span>, <span class="number">0xF</span>]</span><br><span class="line">xor3 = [<span class="number">1</span>, <span class="number">0</span>, <span class="number">9</span>, <span class="number">0xB</span>, <span class="number">0xF</span>, <span class="number">5</span>, <span class="number">0xC</span>, <span class="number">4</span>, <span class="number">0xE</span>, <span class="number">0xD</span>, <span class="number">0xA</span>, <span class="number">8</span>, <span class="number">2</span>, <span class="number">6</span>, <span class="number">3</span>, <span class="number">7</span>]</span><br><span class="line">xor4 = [<span class="number">0xB</span>, <span class="number">3</span>, <span class="number">0xE</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">1</span>, <span class="number">7</span>, <span class="number">0</span>, <span class="number">0xD</span>, <span class="number">0xC</span>, <span class="number">4</span>, <span class="number">8</span>, <span class="number">2</span>, <span class="number">0xA</span>, <span class="number">0xF</span>]</span><br><span class="line">xor5 = [<span class="number">0xD</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">5</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">6</span>, <span class="number">0xA</span>, <span class="number">7</span>, <span class="number">0xB</span>, <span class="number">0xC</span>, <span class="number">3</span>, <span class="number">0xE</span>, <span class="number">0xF</span>]</span><br><span class="line">xor6 = [<span class="number">0xF</span>, <span class="number">0xC</span>, <span class="number">0xA</span>, <span class="number">6</span>, <span class="number">0</span>, <span class="number">9</span>, <span class="number">5</span>, <span class="number">0xE</span>, <span class="number">2</span>, <span class="number">0xB</span>, <span class="number">4</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">1</span>, <span class="number">0xD</span>, <span class="number">3</span>]</span><br><span class="line">xor7 = [<span class="number">0xD</span>, <span class="number">2</span>, <span class="number">9</span>, <span class="number">0</span>, <span class="number">0xF</span>, <span class="number">3</span>, <span class="number">0xA</span>, <span class="number">0xB</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">0xE</span>, <span class="number">7</span>, <span class="number">0xC</span>, <span class="number">1</span>, <span class="number">8</span>]</span><br><span class="line">xor8 = [<span class="number">4</span>, <span class="number">0xE</span>, <span class="number">0</span>, <span class="number">0xF</span>, <span class="number">9</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">0xD</span>, <span class="number">5</span>, <span class="number">1</span>, <span class="number">0xC</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">0xA</span>, <span class="number">0xB</span>, <span class="number">6</span>]</span><br><span class="line">idx = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">7</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">key_to_tmp</span>(<span class="params">key</span>):</span><br><span class="line">	<span class="keyword">return</span> (xor1.index((key&gt;&gt;<span class="number">0x1c</span>)&amp;<span class="number">0xf</span>)&lt;&lt;<span class="number">28</span>)|(xor2.index((key&gt;&gt;<span class="number">0x18</span>)&amp;<span class="number">0xf</span>)&lt;&lt;<span class="number">24</span>)|(xor3.index((key&gt;&gt;<span class="number">0x14</span>)&amp;<span class="number">0xf</span>)&lt;&lt;<span class="number">20</span>)|(xor4.index((key&gt;&gt;<span class="number">0x10</span>)&amp;<span class="number">0xf</span>)&lt;&lt;<span class="number">16</span>)|(xor5.index((key&gt;&gt;<span class="number">0xc</span>)&amp;<span class="number">0xf</span>)&lt;&lt;<span class="number">12</span>)|(xor6.index((key&gt;&gt;<span class="number">0x8</span>)&amp;<span class="number">0xf</span>)&lt;&lt;<span class="number">8</span>)|(xor7.index((key&gt;&gt;<span class="number">0x4</span>)&amp;<span class="number">0xf</span>)&lt;&lt;<span class="number">4</span>)|(xor8.index((key)&amp;<span class="number">0xf</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decode1</span>(<span class="params"><span class="built_in">input</span>,i0,i1</span>):</span><br><span class="line">	xor0_idx = <span class="number">0</span></span><br><span class="line">	key = <span class="built_in">input</span>[i1]</span><br><span class="line">	tmp = key_to_tmp(key)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">30</span>,-<span class="number">1</span>,-<span class="number">1</span>):</span><br><span class="line">		key = <span class="built_in">input</span>[i0]</span><br><span class="line">		<span class="built_in">input</span>[i1] = key ^ tmp ^ xor0[idx[xor0_idx]]</span><br><span class="line">		<span class="built_in">input</span>[i0] = <span class="built_in">input</span>[i1]</span><br><span class="line">		tmp = key_to_tmp(key)</span><br><span class="line">		xor0_idx += <span class="number">1</span></span><br><span class="line">	</span><br><span class="line">	<span class="built_in">input</span>[i1] = <span class="built_in">input</span>[i0] ^ xor0[idx[xor0_idx]] ^ tmp</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decode2</span>(<span class="params">what</span>):</span><br><span class="line">	input_byte = input_enc.copy()</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">31</span>,-<span class="number">1</span>,-<span class="number">1</span>):</span><br><span class="line">		what ^= <span class="number">0xa5</span></span><br><span class="line">		what -= input_byte[i]</span><br><span class="line">		<span class="keyword">if</span> what &lt; <span class="number">0</span>:</span><br><span class="line">			what += <span class="number">0x100</span></span><br><span class="line">		input_byte[i] = what ^ input_byte[i] ^ input_byte[(i+<span class="number">1</span>)&amp;<span class="number">0x1f</span>] ^ <span class="number">0xff</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">31</span>,-<span class="number">1</span>,-<span class="number">1</span>):</span><br><span class="line">		what ^= <span class="number">0xa5</span></span><br><span class="line">		what -= input_byte[i]</span><br><span class="line">		<span class="keyword">if</span> what &lt; <span class="number">0</span>:</span><br><span class="line">			what += <span class="number">0x100</span></span><br><span class="line">		input_byte[i] = what ^ input_byte[i] ^ input_byte[(i+<span class="number">1</span>)&amp;<span class="number">0x1f</span>] ^ <span class="number">0xff</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> what == ((input_byte[<span class="number">0</span>] + input_byte[-<span class="number">1</span>]) &amp; <span class="number">0xff</span>):</span><br><span class="line">		dec = []</span><br><span class="line">		<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">32</span>,<span class="number">4</span>):</span><br><span class="line">			dec.append(input_byte[i]|(input_byte[i+<span class="number">1</span>]&lt;&lt;<span class="number">8</span>)|(input_byte[i+<span class="number">2</span>]&lt;&lt;<span class="number">16</span>)|(input_byte[i+<span class="number">3</span>]&lt;&lt;<span class="number">24</span>))</span><br><span class="line">		decode_1.append(dec)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0xff</span>):</span><br><span class="line">	decode2(i)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> decode_1:</span><br><span class="line">	decode1(i,<span class="number">0</span>,<span class="number">3</span>)</span><br><span class="line">	decode1(i,<span class="number">1</span>,<span class="number">2</span>)</span><br><span class="line">	decode1(i,<span class="number">4</span>,<span class="number">6</span>)</span><br><span class="line">	decode1(i,<span class="number">5</span>,<span class="number">7</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> decode_1:</span><br><span class="line">	f = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">	<span class="keyword">for</span> j <span class="keyword">in</span> i:</span><br><span class="line">		f +=pack(<span class="string">&#x27;&lt;I&#x27;</span>,j)</span><br><span class="line">	<span class="built_in">print</span>(f)</span><br><span class="line"><span class="comment">#b&#x27;S3hr0din7er_3_Uni4er3al_D00rs111&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="5-crackme"><a href="#5-crackme" class="headerlink" title="5_crackme"></a>5_crackme</h3><p>还没复现，先占个位，等学弟浇浇我移动安全再来做（逃</p>
<h2 id="CISCN-初赛"><a href="#CISCN-初赛" class="headerlink" title="CISCN 初赛"></a>CISCN 初赛</h2><h3 id="baby-ast"><a href="#baby-ast" class="headerlink" title="baby ast"></a>baby ast</h3><p>算是拖了很久，对这题充满了不想复现的恐惧……其实比赛的时候早就装好swift了，也想过自己编译一段语法树出来对照代码看看，但是总觉得很麻烦，又耐不下心去看……<br>总觉得八百多行很多很恐惧，但是现在看也就还行……</p>
<p>测试代码<code>tmp.swift</code>：（语法好像有点问题，我也没仔细看swift的语法，凑合看8</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">check</span>(<span class="params">keyValue</span>: <span class="type">String</span>, <span class="params">encoded</span>: <span class="type">String</span>) -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> a <span class="operator">=</span> <span class="number">9</span></span><br><span class="line">	<span class="keyword">let</span> b <span class="operator">=</span> <span class="number">10</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> a <span class="operator">^</span> b</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(check(<span class="string">&quot;1234&quot;</span>,<span class="string">&quot;dfgh&quot;</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> n <span class="operator">=</span> [<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">0</span><span class="operator">...</span><span class="number">3</span>&#123;</span><br><span class="line">	n[i] <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用命令<code>swiftc  -dump-ast tmp.swift</code>来得到抽象语法树。</p>
<p><code>func check(keyValue: String, encoded: String) -&gt; Int &#123;</code>对应</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">(func_decl range=[tmp.swift:1:1 - line:6:1] &quot;check(keyValue:encoded:)&quot; interface type=&#x27;(String, String) -&gt; Int&#x27; access=internal</span><br><span class="line">  (parameter_list range=[tmp.swift:1:11 - line:1:45]</span><br><span class="line">    (parameter &quot;keyValue&quot; apiName=keyValue type=&#x27;String&#x27; interface type=&#x27;String&#x27;)</span><br><span class="line">    (parameter &quot;encoded&quot; apiName=encoded type=&#x27;String&#x27; interface type=&#x27;String&#x27;))</span><br><span class="line">  (result</span><br><span class="line">    (type_ident</span><br><span class="line">      (component id=&#x27;Int&#x27; bind=Swift.(file).Int)))</span><br></pre></td></tr></table></figure>

<p>所以题目里的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">(func_decl range=[re.swift:1:1 - line:14:1] &quot;check(_:_:)&quot; interface type=&#x27;(String, String) -&gt; Bool&#x27; access=internal</span><br><span class="line">  (parameter_list range=[re.swift:1:11 - line:1:49]</span><br><span class="line">    (parameter &quot;encoded&quot; type=&#x27;String&#x27; interface type=&#x27;String&#x27;)</span><br><span class="line">    (parameter &quot;keyValue&quot; type=&#x27;String&#x27; interface type=&#x27;String&#x27;))</span><br><span class="line">  (result</span><br><span class="line">    (type_ident</span><br><span class="line">      (component id=&#x27;Bool&#x27; bind=Swift.(file).Bool)))</span><br></pre></td></tr></table></figure>

<p>对应的应该就是<code>check(_: String,_: String) -&gt; Bool</code>，即定义一个check函数，返回值为布尔类型。</p>
<p><code>let a = 9</code>对应</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">(pattern_binding_decl range=[tmp.swift:2:5 - line:2:13]</span><br><span class="line">  (pattern_named type=&#x27;Int&#x27; &#x27;a&#x27;)</span><br><span class="line">  Original init:</span><br><span class="line">  (integer_literal_expr type=&#x27;Int&#x27; location=tmp.swift:2:13 range=[tmp.swift:2:13 - line:2:13] value=9 builtin_initializer=Swift.(file).Int.init(_builtinIntegerLiteral:) initializer=**NULL**)</span><br><span class="line">  Processed init:</span><br><span class="line">  (integer_literal_expr type=&#x27;Int&#x27; location=tmp.swift:2:13 range=[tmp.swift:2:13 - line:2:13] value=9 builtin_initializer=Swift.(file).Int.init(_builtinIntegerLiteral:) initializer=**NULL**))</span><br><span class="line"></span><br><span class="line">(var_decl range=[tmp.swift:2:9 - line:2:9] &quot;a&quot; type=&#x27;Int&#x27; interface type=&#x27;Int&#x27; access=private let readImpl=stored immutable)</span><br><span class="line"></span><br><span class="line">(pattern_binding_decl range=[tmp.swift:3:2 - line:3:10]</span><br></pre></td></tr></table></figure>

<p><code>let b = 10</code>同理。</p>
<p><code>return a ^ b</code>对应</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">(return_stmt range=[tmp.swift:5:5 - line:5:16]</span><br><span class="line">  (binary_expr type=&#x27;Int&#x27; location=tmp.swift:5:14 range=[tmp.swift:5:12 - line:5:16] nothrow</span><br><span class="line">    (dot_syntax_call_expr implicit type=&#x27;(Int, Int) -&gt; Int&#x27; location=tmp.swift:5:14 range=[tmp.swift:5:14 - line:5:14] nothrow</span><br><span class="line">      (declref_expr type=&#x27;(Int.Type) -&gt; (Int, Int) -&gt; Int&#x27; location=tmp.swift:5:14 range=[tmp.swift:5:14 - line:5:14] decl=Swift.(file).Int extension.^ function_ref=single)</span><br><span class="line">      (argument_list implicit</span><br><span class="line">        (argument</span><br><span class="line">          (type_expr implicit type=&#x27;Int.Type&#x27; location=tmp.swift:5:14 range=[tmp.swift:5:14 - line:5:14] typerepr=&#x27;Int&#x27;))</span><br><span class="line">      ))</span><br><span class="line">    (argument_list implicit</span><br><span class="line">      (argument</span><br><span class="line">        (declref_expr type=&#x27;Int&#x27; location=tmp.swift:5:12 range=[tmp.swift:5:12 - line:5:12] decl=tmp.(file).check(keyValue:encoded:).a@tmp.swift:2:9 function_ref=unapplied))</span><br><span class="line">      (argument</span><br><span class="line">        (declref_expr type=&#x27;Int&#x27; location=tmp.swift:5:16 range=[tmp.swift:5:16 - line:5:16] decl=tmp.(file).check(keyValue:encoded:).b@tmp.swift:3:6 function_ref=unapplied))</span><br><span class="line">    )))))</span><br></pre></td></tr></table></figure>

<p>其中运算符<code>^</code>在<code>extension.^</code></p>
<p><code>print(check(&quot;1234&quot;,&quot;dfgh&quot;))</code>对应</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">(top_level_code_decl range=[tmp.swift:8:1 - line:8:27]</span><br><span class="line">  (brace_stmt implicit range=[tmp.swift:8:1 - line:8:27]</span><br><span class="line">    (call_expr type=&#x27;&lt;null&gt;&#x27;</span><br><span class="line">      (overloaded_decl_ref_expr type=&#x27;&lt;null&gt;&#x27; name=print number_of_decls=2 function_ref=single decls=[</span><br><span class="line">        Swift.(file).print(_:separator:terminator:),</span><br><span class="line">        Swift.(file).print(_:separator:terminator:to:)])</span><br><span class="line">      (argument_list</span><br><span class="line">        (argument</span><br><span class="line">          (call_expr type=&#x27;&lt;null&gt;&#x27;</span><br><span class="line">            (declref_expr type=&#x27;&lt;null&gt;&#x27; decl=tmp.(file).check(keyValue:encoded:)@tmp.swift:1:6 function_ref=single)</span><br><span class="line">            (argument_list</span><br><span class="line">              (argument</span><br><span class="line">                (string_literal_expr type=&#x27;&lt;null&gt;&#x27; encoding=utf8 value=&quot;1234&quot; builtin_initializer=**NULL** initializer=**NULL**))</span><br><span class="line">              (argument</span><br><span class="line">                (string_literal_expr type=&#x27;&lt;null&gt;&#x27; encoding=utf8 value=&quot;dfgh&quot; builtin_initializer=**NULL** initializer=**NULL**))</span><br><span class="line">            )))</span><br><span class="line">      ))))</span><br></pre></td></tr></table></figure>

<p><code>let n = [0,1,2,3]</code>对应</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">  (top_level_code_decl range=[tmp.swift:10:1 - line:10:17]</span><br><span class="line">    (brace_stmt implicit range=[tmp.swift:10:1 - line:10:17]</span><br><span class="line">      (pattern_binding_decl range=[tmp.swift:10:1 - line:10:17]</span><br><span class="line">        (pattern_named type=&#x27;[Int]&#x27; &#x27;n&#x27;)</span><br><span class="line">        Original init:</span><br><span class="line">        (array_expr type=&#x27;[Int]&#x27; location=tmp.swift:10:9 range=[tmp.swift:10:9 - line:10:17] initializer=Swift.(file).Array extension.init(arrayLiteral:) [with (substitution_map generic_signature=&lt;Element&gt; (substitution Element -&gt; Int))]</span><br><span class="line">          (integer_literal_expr type=&#x27;Int&#x27; location=tmp.swift:10:10 range=[tmp.swift:10:10 - line:10:10] value=0 builtin_initializer=Swift.(file).Int.init(_builtinIntegerLiteral:) initializer=**NULL**)</span><br><span class="line">          (integer_literal_expr type=&#x27;Int&#x27; location=tmp.swift:10:12 range=[tmp.swift:10:12 - line:10:12] value=1 builtin_initializer=Swift.(file).Int.init(_builtinIntegerLiteral:) initializer=**NULL**)</span><br><span class="line">          (integer_literal_expr type=&#x27;Int&#x27; location=tmp.swift:10:14 range=[tmp.swift:10:14 - line:10:14] value=2 builtin_initializer=Swift.(file).Int.init(_builtinIntegerLiteral:) initializer=**NULL**)</span><br><span class="line">          (integer_literal_expr type=&#x27;Int&#x27; location=tmp.swift:10:16 range=[tmp.swift:10:16 - line:10:16] value=3 builtin_initializer=Swift.(file).Int.init(_builtinIntegerLiteral:) initializer=**NULL**))</span><br><span class="line">        Processed init:</span><br><span class="line">        (array_expr type=&#x27;[Int]&#x27; location=tmp.swift:10:9 range=[tmp.swift:10:9 - line:10:17] initializer=Swift.(file).Array extension.init(arrayLiteral:) [with (substitution_map generic_signature=&lt;Element&gt; (substitution Element -&gt; Int))]</span><br><span class="line">          (integer_literal_expr type=&#x27;Int&#x27; location=tmp.swift:10:10 range=[tmp.swift:10:10 - line:10:10] value=0 builtin_initializer=Swift.(file).Int.init(_builtinIntegerLiteral:) initializer=**NULL**)</span><br><span class="line">          (integer_literal_expr type=&#x27;Int&#x27; location=tmp.swift:10:12 range=[tmp.swift:10:12 - line:10:12] value=1 builtin_initializer=Swift.(file).Int.init(_builtinIntegerLiteral:) initializer=**NULL**)</span><br><span class="line">          (integer_literal_expr type=&#x27;Int&#x27; location=tmp.swift:10:14 range=[tmp.swift:10:14 - line:10:14] value=2 builtin_initializer=Swift.(file).Int.init(_builtinIntegerLiteral:) initializer=**NULL**)</span><br><span class="line">          (integer_literal_expr type=&#x27;Int&#x27; location=tmp.swift:10:16 range=[tmp.swift:10:16 - line:10:16] value=3 builtin_initializer=Swift.(file).Int.init(_builtinIntegerLiteral:) initializer=**NULL**)))</span><br><span class="line">))</span><br><span class="line">  (var_decl range=[tmp.swift:10:5 - line:10:5] &quot;n&quot; type=&#x27;[Int]&#x27; interface type=&#x27;[Int]&#x27; access=internal let readImpl=stored immutable)</span><br></pre></td></tr></table></figure>

<p><code>for i in 0...3&#123;&#125;</code>对应</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">(brace_stmt implicit range=[tmp.swift:11:1 - line:13:1]</span><br><span class="line">  (for_each_stmt range=[tmp.swift:11:1 - line:13:1]</span><br><span class="line">    (pattern_named type=&#x27;Int&#x27; &#x27;i&#x27;)</span><br><span class="line">    (pattern_named type=&#x27;Int&#x27; &#x27;i&#x27;)</span><br><span class="line">    (binary_expr type=&#x27;ClosedRange&lt;Int&gt;&#x27; location=tmp.swift:11:11 range=[tmp.swift:11:10 - line:11:14] nothrow</span><br><span class="line">      (dot_syntax_call_expr implicit type=&#x27;(Int, Int) -&gt; ClosedRange&lt;Int&gt;&#x27; location=tmp.swift:11:11 range=[tmp.swift:11:11 - line:11:11] nothrow</span><br><span class="line">        (declref_expr type=&#x27;(Int.Type) -&gt; (Int, Int) -&gt; ClosedRange&lt;Int&gt;&#x27; location=tmp.swift:11:11 range=[tmp.swift:11:11 - line:11:11] decl=Swift.(file).Comparable extension.... [with (substitution_map generic_signature=&lt;Self where Self : Comparable&gt; (substitution Self -&gt; Int))] function_ref=double)</span><br><span class="line">        (argument_list implicit</span><br><span class="line">          (argument</span><br><span class="line">            (type_expr implicit type=&#x27;Int.Type&#x27; location=tmp.swift:11:11 range=[tmp.swift:11:11 - line:11:11] typerepr=&#x27;Int&#x27;))</span><br><span class="line">        ))</span><br><span class="line">      (argument_list implicit</span><br><span class="line">        (argument</span><br><span class="line">          (integer_literal_expr type=&#x27;Int&#x27; location=tmp.swift:11:10 range=[tmp.swift:11:10 - line:11:10] value=0 builtin_initializer=Swift.(file).Int.init(_builtinIntegerLiteral:) initializer=**NULL**))</span><br><span class="line">        (argument</span><br><span class="line">          (integer_literal_expr type=&#x27;Int&#x27; location=tmp.swift:11:14 range=[tmp.swift:11:14 - line:11:14] value=3 builtin_initializer=Swift.(file).Int.init(_builtinIntegerLiteral:) initializer=**NULL**))</span><br><span class="line">      ))</span><br><span class="line">    (var_decl implicit range=[tmp.swift:11:7 - line:11:7] &quot;$i$generator&quot; type=&#x27;ClosedRange&lt;Int&gt;.Iterator&#x27; interface type=&#x27;ClosedRange&lt;Int&gt;.Iterator&#x27; access=fileprivate readImpl=stored writeImpl=stored readWriteImpl=stored)</span><br><span class="line"></span><br><span class="line">    (declref_expr implicit type=&#x27;@lvalue ClosedRange&lt;Int&gt;.Iterator&#x27; location=tmp.swift:11:7 range=[tmp.swift:11:7 - line:11:7] decl=tmp.(file).top-level code.$i$generator@tmp.swift:11:7 function_ref=unapplied)</span><br><span class="line">    (brace_stmt range=[tmp.swift:11:15 - line:13:1]</span><br></pre></td></tr></table></figure>

<p><code>for_each_stmt</code>创建循环。</p>
<p><code>n[i] = 0</code>对应</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">(assign_expr type=&#x27;()&#x27; location=tmp.swift:12:7 range=[tmp.swift:12:2 - line:12:9]</span><br><span class="line">  (subscript_expr type=&#x27;@lvalue Int&#x27; location=tmp.swift:12:3 range=[tmp.swift:12:2 - line:12:5] decl=Swift.(file).Array extension.subscript(_:) [with (substitution_map generic_signature=&lt;Element&gt; (substitution Element -&gt; Int))]</span><br><span class="line">    (inout_expr implicit type=&#x27;inout Array&lt;Int&gt;&#x27; location=tmp.swift:12:2 range=[tmp.swift:12:2 - line:12:2]</span><br><span class="line">      (declref_expr type=&#x27;@lvalue [Int]&#x27; location=tmp.swift:12:2 range=[tmp.swift:12:2 - line:12:2] decl=tmp.(file).n@tmp.swift:10:5 function_ref=unapplied))</span><br><span class="line">    (argument_list</span><br><span class="line">      (argument</span><br><span class="line">        (declref_expr type=&#x27;Int&#x27; location=tmp.swift:12:4 range=[tmp.swift:12:4 - line:12:4] decl=tmp.(file).top-level code.i@tmp.swift:11:5 function_ref=unapplied))</span><br><span class="line">    ))</span><br><span class="line">  (integer_literal_expr type=&#x27;Int&#x27; location=tmp.swift:12:9 range=[tmp.swift:12:9 - line:12:9] value=0 builtin_initializer=Swift.(file).Int.init(_builtinIntegerLiteral:) initializer=**NULL**)))))))</span><br></pre></td></tr></table></figure>

<p><code>extension.subscript(_:)</code>表示切片操作。</p>
<p>题目中刚开始定义了一个<code>check(_: String,_: String) -&gt; Bool</code>，然后给两个变量b和k赋值，大概是类似于bytes的操作，即对字符串解码存为ASCII码，然后定义4个变量r0,r1,r2,r3。</p>
<p>定义for循环：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">(for_each_stmt range=[re.swift:5:5 - line:12:5]</span><br><span class="line">  (pattern_named type=&#x27;Int&#x27; &#x27;i&#x27;)</span><br><span class="line">  (pattern_named type=&#x27;Int&#x27; &#x27;i&#x27;)</span><br><span class="line">  (binary_expr type=&#x27;ClosedRange&lt;Int&gt;&#x27; location=re.swift:5:15 range=[re.swift:5:14 - line:5:26] nothrow</span><br><span class="line">    (dot_syntax_call_expr implicit type=&#x27;(Int, Int) -&gt; ClosedRange&lt;Int&gt;&#x27; location=re.swift:5:15 range=[re.swift:5:15 - line:5:15] nothrow</span><br><span class="line">      (declref_expr type=&#x27;(Int.Type) -&gt; (Int, Int) -&gt; ClosedRange&lt;Int&gt;&#x27; location=re.swift:5:15 range=[re.swift:5:15 - line:5:15] decl=Swift.(file).Comparable extension.... [with (substitution_map generic_signature=&lt;Self where Self : Comparable&gt; (substitution Self -&gt; Int))] function_ref=double)</span><br><span class="line">      (argument_list implicit</span><br><span class="line">        (argument</span><br><span class="line">          (type_expr implicit type=&#x27;Int.Type&#x27; location=re.swift:5:15 range=[re.swift:5:15 - line:5:15] typerepr=&#x27;Int&#x27;))</span><br><span class="line">      ))</span><br><span class="line">    (argument_list implicit</span><br><span class="line">      (argument</span><br><span class="line">        (integer_literal_expr type=&#x27;Int&#x27; location=re.swift:5:14 range=[re.swift:5:14 - line:5:14] value=0 builtin_initializer=Swift.(file).Int.init(_builtinIntegerLiteral:) initializer=**NULL**))</span><br><span class="line">      (argument</span><br><span class="line">        (binary_expr type=&#x27;Int&#x27; location=re.swift:5:25 range=[re.swift:5:18 - line:5:26] nothrow</span><br><span class="line">          (dot_syntax_call_expr implicit type=&#x27;(Int, Int) -&gt; Int&#x27; location=re.swift:5:25 range=[re.swift:5:25 - line:5:25] nothrow</span><br><span class="line">            (declref_expr type=&#x27;(Int.Type) -&gt; (Int, Int) -&gt; Int&#x27; location=re.swift:5:25 range=[re.swift:5:25 - line:5:25] decl=Swift.(file).Int extension.- function_ref=double)</span><br><span class="line">            (argument_list implicit</span><br><span class="line">              (argument</span><br><span class="line">                (type_expr implicit type=&#x27;Int.Type&#x27; location=re.swift:5:25 range=[re.swift:5:25 - line:5:25] typerepr=&#x27;Int&#x27;))</span><br><span class="line">            ))</span><br><span class="line">          (argument_list implicit</span><br><span class="line">            (argument</span><br><span class="line">              (member_ref_expr type=&#x27;Int&#x27; location=re.swift:5:20 range=[re.swift:5:18 - line:5:20] decl=Swift.(file).Array extension.count [with (substitution_map generic_signature=&lt;Element&gt; (substitution Element -&gt; UInt8))]</span><br><span class="line">                (load_expr implicit type=&#x27;[UInt8]&#x27; location=re.swift:5:18 range=[re.swift:5:18 - line:5:18]</span><br><span class="line">                  (declref_expr type=&#x27;@lvalue [UInt8]&#x27; location=re.swift:5:18 range=[re.swift:5:18 - line:5:18] decl=re.(file).check(_:_:).b@re.swift:2:9 function_ref=unapplied))))</span><br><span class="line">            (argument</span><br><span class="line">              (integer_literal_expr type=&#x27;Int&#x27; location=re.swift:5:26 range=[re.swift:5:26 - line:5:26] value=4 builtin_initializer=Swift.(file).Int.init(_builtinIntegerLiteral:) initializer=**NULL**))</span><br><span class="line">          )))</span><br><span class="line">    ))</span><br><span class="line">  (var_decl implicit range=[re.swift:5:11 - line:5:11] &quot;$i$generator&quot; type=&#x27;ClosedRange&lt;Int&gt;.Iterator&#x27; interface type=&#x27;ClosedRange&lt;Int&gt;.Iterator&#x27; access=private readImpl=stored writeImpl=stored readWriteImpl=stored)</span><br><span class="line"></span><br><span class="line">  (declref_expr implicit type=&#x27;@lvalue ClosedRange&lt;Int&gt;.Iterator&#x27; location=re.swift:5:11 range=[re.swift:5:11 - line:5:11] decl=re.(file).check(_:_:).$i$generator@re.swift:5:11 function_ref=unapplied)</span><br><span class="line">  (brace_stmt range=[re.swift:5:27 - line:12:5]</span><br></pre></td></tr></table></figure>

<p><code>extension....</code>表示<code>for i in x...y</code>的形式，x和y可以根据缩进来判断。<br>x定义在</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(argument</span><br><span class="line">  (integer_literal_expr type=&#x27;Int&#x27; location=re.swift:5:14 range=[re.swift:5:14 - line:5:14] value=0 builtin_initializer=Swift.(file).Int.init(_builtinIntegerLiteral:) initializer=**NULL**))</span><br></pre></td></tr></table></figure>
<p>即x=0。</p>
<p>y定义在</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">  (argument</span><br><span class="line">    (binary_expr type=&#x27;Int&#x27; location=re.swift:5:25 range=[re.swift:5:18 - line:5:26] nothrow</span><br><span class="line">      (dot_syntax_call_expr implicit type=&#x27;(Int, Int) -&gt; Int&#x27; location=re.swift:5:25 range=[re.swift:5:25 - line:5:25] nothrow</span><br><span class="line">        (declref_expr type=&#x27;(Int.Type) -&gt; (Int, Int) -&gt; Int&#x27; location=re.swift:5:25 range=[re.swift:5:25 - line:5:25] decl=Swift.(file).Int extension.- function_ref=double)</span><br><span class="line">        (argument_list implicit</span><br><span class="line">          (argument</span><br><span class="line">            (type_expr implicit type=&#x27;Int.Type&#x27; location=re.swift:5:25 range=[re.swift:5:25 - line:5:25] typerepr=&#x27;Int&#x27;))</span><br><span class="line">        ))</span><br><span class="line">      (argument_list implicit</span><br><span class="line">        (argument</span><br><span class="line">          (member_ref_expr type=&#x27;Int&#x27; location=re.swift:5:20 range=[re.swift:5:18 - line:5:20] decl=Swift.(file).Array extension.count [with (substitution_map generic_signature=&lt;Element&gt; (substitution Element -&gt; UInt8))]</span><br><span class="line">            (load_expr implicit type=&#x27;[UInt8]&#x27; location=re.swift:5:18 range=[re.swift:5:18 - line:5:18]</span><br><span class="line">              (declref_expr type=&#x27;@lvalue [UInt8]&#x27; location=re.swift:5:18 range=[re.swift:5:18 - line:5:18] decl=re.(file).check(_:_:).b@re.swift:2:9 function_ref=unapplied))))</span><br><span class="line">        (argument</span><br><span class="line">          (integer_literal_expr type=&#x27;Int&#x27; location=re.swift:5:26 range=[re.swift:5:26 - line:5:26] value=4 builtin_initializer=Swift.(file).Int.init(_builtinIntegerLiteral:) initializer=**NULL**))</span><br><span class="line">      )))</span><br><span class="line">))</span><br></pre></td></tr></table></figure>

<p>即<code>y=b.count-4</code>，翻译成python就是<code>y=len(b)-4</code>。<br>由于swift的for in循环含首也含尾，所以这句翻译成python的形式应该是<code>for i in range(len(b)-4+1)</code></p>
<p>再往下，</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">(tuple_expr type=&#x27;(@lvalue UInt8, @lvalue UInt8, @lvalue UInt8, @lvalue UInt8)&#x27; location=re.swift:6:9 range=[re.swift:6:9 - line:6:24] names=&#x27;&#x27;,&#x27;&#x27;,&#x27;&#x27;,&#x27;&#x27;</span><br><span class="line">  (declref_expr type=&#x27;@lvalue UInt8&#x27; location=re.swift:6:10 range=[re.swift:6:10 - line:6:10] decl=re.(file).check(_:_:).r0@re.swift:4:9 function_ref=unapplied)</span><br><span class="line">  (declref_expr type=&#x27;@lvalue UInt8&#x27; location=re.swift:6:14 range=[re.swift:6:14 - line:6:14] decl=re.(file).check(_:_:).r1@re.swift:4:13 function_ref=unapplied)</span><br><span class="line">  (declref_expr type=&#x27;@lvalue UInt8&#x27; location=re.swift:6:18 range=[re.swift:6:18 - line:6:18] decl=re.(file).check(_:_:).r2@re.swift:4:17 function_ref=unapplied)</span><br><span class="line">  (declref_expr type=&#x27;@lvalue UInt8&#x27; location=re.swift:6:22 range=[re.swift:6:22 - line:6:22] decl=re.(file).check(_:_:).r3@re.swift:4:21 function_ref=unapplied))</span><br></pre></td></tr></table></figure>
<p>即<code>r0,r1,r2,r3 = </code></p>
<p>下一步切片操作，以第2个为例，即</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">(subscript_expr type=&#x27;@lvalue UInt8&#x27; location=re.swift:6:36 range=[re.swift:6:35 - line:6:40] decl=Swift.(file).Array extension.subscript(_:) [with (substitution_map generic_signature=&lt;Element&gt; (substitution Element -&gt; UInt8))]</span><br><span class="line">  (inout_expr implicit type=&#x27;inout Array&lt;UInt8&gt;&#x27; location=re.swift:6:35 range=[re.swift:6:35 - line:6:35]</span><br><span class="line">    (declref_expr type=&#x27;@lvalue [UInt8]&#x27; location=re.swift:6:35 range=[re.swift:6:35 - line:6:35] decl=re.(file).check(_:_:).b@re.swift:2:9 function_ref=unapplied))</span><br><span class="line">  (argument_list</span><br><span class="line">    (argument</span><br><span class="line">      (binary_expr type=&#x27;Int&#x27; location=re.swift:6:38 range=[re.swift:6:37 - line:6:39] nothrow</span><br><span class="line">        (dot_syntax_call_expr implicit type=&#x27;(Int, Int) -&gt; Int&#x27; location=re.swift:6:38 range=[re.swift:6:38 - line:6:38] nothrow</span><br><span class="line">          (declref_expr type=&#x27;(Int.Type) -&gt; (Int, Int) -&gt; Int&#x27; location=re.swift:6:38 range=[re.swift:6:38 - line:6:38] decl=Swift.(file).Int extension.+ function_ref=double)</span><br><span class="line">          (argument_list implicit</span><br><span class="line">            (argument</span><br><span class="line">              (type_expr implicit type=&#x27;Int.Type&#x27; location=re.swift:6:38 range=[re.swift:6:38 - line:6:38] typerepr=&#x27;Int&#x27;))</span><br><span class="line">          ))</span><br><span class="line">        (argument_list implicit</span><br><span class="line">          (argument</span><br><span class="line">            (declref_expr type=&#x27;Int&#x27; location=re.swift:6:37 range=[re.swift:6:37 - line:6:37] decl=re.(file).check(_:_:).i@re.swift:5:9 function_ref=unapplied))</span><br><span class="line">          (argument</span><br><span class="line">            (integer_literal_expr type=&#x27;Int&#x27; location=re.swift:6:39 range=[re.swift:6:39 - line:6:39] value=1 builtin_initializer=Swift.(file).Int.init(_builtinIntegerLiteral:) initializer=**NULL**))</span><br><span class="line">        )))</span><br><span class="line">  )))</span><br></pre></td></tr></table></figure>

<p>其中操作对象是b（<code>re.(file).check(_:_:).b@re.swift</code>）和i（<code>re.(file).check(_:_:).i@re.swift</code>），运算符是+（<code>extension.+</code>），值为1，即<code>b[i+1]</code></p>
<p>整理一下就是<code>r0,r1,r2,r3=b[i],b[i+1],b[i+2],b[i+3]</code></p>
<p>加密部分第一句</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line">(assign_expr type=&#x27;()&#x27; location=re.swift:7:16 range=[re.swift:7:9 - line:7:49]</span><br><span class="line">  (subscript_expr type=&#x27;@lvalue UInt8&#x27; location=re.swift:7:10 range=[re.swift:7:9 - line:7:14] decl=Swift.(file).Array extension.subscript(_:) [with (substitution_map generic_signature=&lt;Element&gt; (substitution Element -&gt; UInt8))]</span><br><span class="line">    (inout_expr implicit type=&#x27;inout Array&lt;UInt8&gt;&#x27; location=re.swift:7:9 range=[re.swift:7:9 - line:7:9]</span><br><span class="line">      (declref_expr type=&#x27;@lvalue [UInt8]&#x27; location=re.swift:7:9 range=[re.swift:7:9 - line:7:9] decl=re.(file).check(_:_:).b@re.swift:2:9 function_ref=unapplied))</span><br><span class="line">    (argument_list</span><br><span class="line">      (argument</span><br><span class="line">        (binary_expr type=&#x27;Int&#x27; location=re.swift:7:12 range=[re.swift:7:11 - line:7:13] nothrow</span><br><span class="line">          (dot_syntax_call_expr implicit type=&#x27;(Int, Int) -&gt; Int&#x27; location=re.swift:7:12 range=[re.swift:7:12 - line:7:12] nothrow</span><br><span class="line">            (declref_expr type=&#x27;(Int.Type) -&gt; (Int, Int) -&gt; Int&#x27; location=re.swift:7:12 range=[re.swift:7:12 - line:7:12] decl=Swift.(file).Int extension.+ function_ref=double)</span><br><span class="line">            (argument_list implicit</span><br><span class="line">              (argument</span><br><span class="line">                (type_expr implicit type=&#x27;Int.Type&#x27; location=re.swift:7:12 range=[re.swift:7:12 - line:7:12] typerepr=&#x27;Int&#x27;))</span><br><span class="line">            ))</span><br><span class="line">          (argument_list implicit</span><br><span class="line">            (argument</span><br><span class="line">              (declref_expr type=&#x27;Int&#x27; location=re.swift:7:11 range=[re.swift:7:11 - line:7:11] decl=re.(file).check(_:_:).i@re.swift:5:9 function_ref=unapplied))</span><br><span class="line">            (argument</span><br><span class="line">              (integer_literal_expr type=&#x27;Int&#x27; location=re.swift:7:13 range=[re.swift:7:13 - line:7:13] value=0 builtin_initializer=Swift.(file).Int.init(_builtinIntegerLiteral:) initializer=**NULL**))</span><br><span class="line">          )))</span><br><span class="line">    ))</span><br><span class="line">  (binary_expr type=&#x27;UInt8&#x27; location=re.swift:7:21 range=[re.swift:7:18 - line:7:49] nothrow</span><br><span class="line">    (dot_syntax_call_expr implicit type=&#x27;(UInt8, UInt8) -&gt; UInt8&#x27; location=re.swift:7:21 range=[re.swift:7:21 - line:7:21] nothrow</span><br><span class="line">      (declref_expr type=&#x27;(UInt8.Type) -&gt; (UInt8, UInt8) -&gt; UInt8&#x27; location=re.swift:7:21 range=[re.swift:7:21 - line:7:21] decl=Swift.(file).UInt8 extension.^ function_ref=single)</span><br><span class="line">      (argument_list implicit</span><br><span class="line">        (argument</span><br><span class="line">          (type_expr implicit type=&#x27;UInt8.Type&#x27; location=re.swift:7:21 range=[re.swift:7:21 - line:7:21] typerepr=&#x27;UInt8&#x27;))</span><br><span class="line">      ))</span><br><span class="line">    (argument_list implicit</span><br><span class="line">      (argument</span><br><span class="line">        (load_expr implicit type=&#x27;UInt8&#x27; location=re.swift:7:18 range=[re.swift:7:18 - line:7:18]</span><br><span class="line">          (declref_expr type=&#x27;@lvalue UInt8&#x27; location=re.swift:7:18 range=[re.swift:7:18 - line:7:18] decl=re.(file).check(_:_:).r2@re.swift:4:17 function_ref=unapplied)))</span><br><span class="line">      (argument</span><br><span class="line">        (paren_expr type=&#x27;(UInt8)&#x27; location=re.swift:7:43 range=[re.swift:7:23 - line:7:49]</span><br><span class="line">          (binary_expr type=&#x27;UInt8&#x27; location=re.swift:7:43 range=[re.swift:7:24 - line:7:45] nothrow</span><br><span class="line">            (dot_syntax_call_expr implicit type=&#x27;(UInt8, UInt8) -&gt; UInt8&#x27; location=re.swift:7:43 range=[re.swift:7:43 - line:7:43] nothrow</span><br><span class="line">              (declref_expr type=&#x27;(UInt8.Type) -&gt; (UInt8, UInt8) -&gt; UInt8&#x27; location=re.swift:7:43 range=[re.swift:7:43 - line:7:43] decl=Swift.(file).UInt8 extension.&amp; function_ref=double)</span><br><span class="line">              (argument_list implicit</span><br><span class="line">                (argument</span><br><span class="line">                  (type_expr implicit type=&#x27;UInt8.Type&#x27; location=re.swift:7:43 range=[re.swift:7:43 - line:7:43] typerepr=&#x27;UInt8&#x27;))</span><br><span class="line">              ))</span><br><span class="line">            (argument_list implicit</span><br><span class="line">              (argument</span><br><span class="line">                (paren_expr type=&#x27;(UInt8)&#x27; location=re.swift:7:30 range=[re.swift:7:24 - line:7:41]</span><br><span class="line">                  (binary_expr type=&#x27;UInt8&#x27; location=re.swift:7:30 range=[re.swift:7:25 - line:7:40] nothrow</span><br><span class="line">                    (dot_syntax_call_expr implicit type=&#x27;(UInt8, UInt8) -&gt; UInt8&#x27; location=re.swift:7:30 range=[re.swift:7:30 - line:7:30] nothrow</span><br><span class="line">                      (declref_expr type=&#x27;(UInt8.Type) -&gt; (UInt8, UInt8) -&gt; UInt8&#x27; location=re.swift:7:30 range=[re.swift:7:30 - line:7:30] decl=Swift.(file).UInt8 extension.+ function_ref=double)</span><br><span class="line">                      (argument_list implicit</span><br><span class="line">                        (argument</span><br><span class="line">                          (type_expr implicit type=&#x27;UInt8.Type&#x27; location=re.swift:7:30 range=[re.swift:7:30 - line:7:30] typerepr=&#x27;UInt8&#x27;))</span><br><span class="line">                      ))</span><br><span class="line">                    (argument_list implicit</span><br><span class="line">                      (argument</span><br><span class="line">                        (load_expr implicit type=&#x27;UInt8&#x27; location=re.swift:7:26 range=[re.swift:7:25 - line:7:28]</span><br><span class="line">                          (subscript_expr type=&#x27;@lvalue UInt8&#x27; location=re.swift:7:26 range=[re.swift:7:25 - line:7:28] decl=Swift.(file).Array extension.subscript(_:) [with (substitution_map generic_signature=&lt;Element&gt; (substitution Element -&gt; UInt8))]</span><br><span class="line">                            (inout_expr implicit type=&#x27;inout Array&lt;UInt8&gt;&#x27; location=re.swift:7:25 range=[re.swift:7:25 - line:7:25]</span><br><span class="line">                              (declref_expr type=&#x27;@lvalue [UInt8]&#x27; location=re.swift:7:25 range=[re.swift:7:25 - line:7:25] decl=re.(file).check(_:_:).k@re.swift:3:9 function_ref=unapplied))</span><br><span class="line">                            (argument_list</span><br><span class="line">                              (argument</span><br><span class="line">                                (integer_literal_expr type=&#x27;Int&#x27; location=re.swift:7:27 range=[re.swift:7:27 - line:7:27] value=0 builtin_initializer=Swift.(file).Int.init(_builtinIntegerLiteral:) initializer=**NULL**))</span><br><span class="line">                            ))))</span><br><span class="line">                      (argument</span><br><span class="line">                        (paren_expr type=&#x27;(UInt8)&#x27; location=re.swift:7:36 range=[re.swift:7:32 - line:7:40]</span><br><span class="line">                          (binary_expr type=&#x27;UInt8&#x27; location=re.swift:7:36 range=[re.swift:7:33 - line:7:39] nothrow</span><br><span class="line">                            (dot_syntax_call_expr implicit type=&#x27;(UInt8, Int) -&gt; UInt8&#x27; location=re.swift:7:36 range=[re.swift:7:36 - line:7:36] nothrow</span><br><span class="line">                              (declref_expr type=&#x27;(UInt8.Type) -&gt; (UInt8, Int) -&gt; UInt8&#x27; location=re.swift:7:36 range=[re.swift:7:36 - line:7:36] decl=Swift.(file).FixedWidthInteger extension.&gt;&gt; [with (substitution_map generic_signature=&lt;Self, Other where Self : FixedWidthInteger, Other : BinaryInteger&gt; (substitution Self -&gt; UInt8) (substitution Other -&gt; Int))] function_ref=double)</span><br><span class="line">                              (argument_list implicit</span><br><span class="line">                                (argument</span><br><span class="line">                                  (type_expr implicit type=&#x27;UInt8.Type&#x27; location=re.swift:7:36 range=[re.swift:7:36 - line:7:36] typerepr=&#x27;UInt8&#x27;))</span><br><span class="line">                              ))</span><br><span class="line">                            (argument_list implicit</span><br><span class="line">                              (argument</span><br><span class="line">                                (load_expr implicit type=&#x27;UInt8&#x27; location=re.swift:7:33 range=[re.swift:7:33 - line:7:33]</span><br><span class="line">                                  (declref_expr type=&#x27;@lvalue UInt8&#x27; location=re.swift:7:33 range=[re.swift:7:33 - line:7:33] decl=re.(file).check(_:_:).r0@re.swift:4:9 function_ref=unapplied)))</span><br><span class="line">                              (argument</span><br><span class="line">                                (integer_literal_expr type=&#x27;Int&#x27; location=re.swift:7:39 range=[re.swift:7:39 - line:7:39] value=4 builtin_initializer=Swift.(file).Int.init(_builtinIntegerLiteral:) initializer=**NULL**))</span><br><span class="line">                            ))))</span><br><span class="line">                    ))))</span><br><span class="line">              (argument</span><br><span class="line">                (integer_literal_expr type=&#x27;UInt8&#x27; location=re.swift:7:45 range=[re.swift:7:45 - line:7:45] value=0xff builtin_initializer=Swift.(file).UInt8.init(_builtinIntegerLiteral:) initializer=**NULL**))</span><br><span class="line">            ))))</span><br><span class="line">    )))</span><br></pre></td></tr></table></figure>

<p>这一句是由多个子句构成，从最内层的缩进看起，最内层的两个子句分别是</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">(argument</span><br><span class="line">  (load_expr implicit type=&#x27;UInt8&#x27; location=re.swift:7:26 range=[re.swift:7:25 - line:7:28]</span><br><span class="line">    (subscript_expr type=&#x27;@lvalue UInt8&#x27; location=re.swift:7:26 range=[re.swift:7:25 - line:7:28] decl=Swift.(file).Array extension.subscript(_:) [with (substitution_map generic_signature=&lt;Element&gt; (substitution Element -&gt; UInt8))]</span><br><span class="line">      (inout_expr implicit type=&#x27;inout Array&lt;UInt8&gt;&#x27; location=re.swift:7:25 range=[re.swift:7:25 - line:7:25]</span><br><span class="line">        (declref_expr type=&#x27;@lvalue [UInt8]&#x27; location=re.swift:7:25 range=[re.swift:7:25 - line:7:25] decl=re.(file).check(_:_:).k@re.swift:3:9 function_ref=unapplied))</span><br><span class="line">      (argument_list</span><br><span class="line">        (argument</span><br><span class="line">          (integer_literal_expr type=&#x27;Int&#x27; location=re.swift:7:27 range=[re.swift:7:27 - line:7:27] value=0 builtin_initializer=Swift.(file).Int.init(_builtinIntegerLiteral:) initializer=**NULL**))</span><br><span class="line">      ))))</span><br></pre></td></tr></table></figure>

<p>即<code>k[0]</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">(dot_syntax_call_expr implicit type=&#x27;(UInt8, Int) -&gt; UInt8&#x27; location=re.swift:7:36 range=[re.swift:7:36 - line:7:36] nothrow</span><br><span class="line">  (declref_expr type=&#x27;(UInt8.Type) -&gt; (UInt8, Int) -&gt; UInt8&#x27; location=re.swift:7:36 range=[re.swift:7:36 - line:7:36] decl=Swift.(file).FixedWidthInteger extension.&gt;&gt; [with (substitution_map generic_signature=&lt;Self, Other where Self : FixedWidthInteger, Other : BinaryInteger&gt; (substitution Self -&gt; UInt8) (substitution Other -&gt; Int))] function_ref=double)</span><br><span class="line">  (argument_list implicit</span><br><span class="line">    (argument</span><br><span class="line">      (type_expr implicit type=&#x27;UInt8.Type&#x27; location=re.swift:7:36 range=[re.swift:7:36 - line:7:36] typerepr=&#x27;UInt8&#x27;))</span><br><span class="line">  ))</span><br><span class="line">(argument_list implicit</span><br><span class="line">  (argument</span><br><span class="line">    (load_expr implicit type=&#x27;UInt8&#x27; location=re.swift:7:33 range=[re.swift:7:33 - line:7:33]</span><br><span class="line">      (declref_expr type=&#x27;@lvalue UInt8&#x27; location=re.swift:7:33 range=[re.swift:7:33 - line:7:33] decl=re.(file).check(_:_:).r0@re.swift:4:9 function_ref=unapplied)))</span><br><span class="line">  (argument</span><br><span class="line">    (integer_literal_expr type=&#x27;Int&#x27; location=re.swift:7:39 range=[re.swift:7:39 - line:7:39] value=4 builtin_initializer=Swift.(file).Int.init(_builtinIntegerLiteral:) initializer=**NULL**))</span><br><span class="line">))))</span><br></pre></td></tr></table></figure>

<p>即<code>r0&gt;&gt;4</code></p>
<p>处于同一缩进的子句是同级的关系，两子句的运算符要在次一级缩进处找。</p>
<p><img src="/img/code/chall_photo/ciscn-1.png"></p>
<p>即<code>k[0]+(r0&gt;&gt;4)</code></p>
<p>此后过程大致相同，这一句翻译过来即<code>b[i]^=(k[0]+(r0&gt;&gt;4))&amp;0xff</code>，同理，下一段是<code>b[i+1]^=(k[1]+(r1&gt;&gt;4))&amp;0xff</code></p>
<p>完整加密过程：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(b)-<span class="number">4</span>+<span class="number">1</span>):</span><br><span class="line">  r0,r1,r2,r3=b[i],b[i+<span class="number">1</span>],b[i+<span class="number">2</span>],b[i+<span class="number">3</span>]</span><br><span class="line">  b[i]^=(k[<span class="number">0</span>]+(r0&gt;&gt;<span class="number">4</span>))&amp;<span class="number">0xff</span></span><br><span class="line">  b[i+<span class="number">1</span>]^=(k[<span class="number">1</span>]+(r1&gt;&gt;<span class="number">4</span>))&amp;<span class="number">0xff</span></span><br><span class="line">  b[i+<span class="number">2</span>]^=k[<span class="number">2</span>]</span><br><span class="line">  b[i+<span class="number">3</span>]^=k[<span class="number">3</span>]</span><br><span class="line">  k[<span class="number">0</span>],k[<span class="number">1</span>],k[<span class="number">2</span>],k[<span class="number">3</span>]=k[<span class="number">1</span>],k[<span class="number">2</span>],k[<span class="number">3</span>],k[<span class="number">0</span>]</span><br></pre></td></tr></table></figure>

<p>程序使用的密文可以在五百多行的地方获取到，密钥是<code>&quot;345y&quot;</code>。据此写出解密脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">b=[<span class="number">88</span>,<span class="number">35</span>,<span class="number">88</span>,<span class="number">225</span>,<span class="number">7</span>,<span class="number">201</span>,<span class="number">57</span>,<span class="number">94</span>,<span class="number">77</span>,<span class="number">56</span>,<span class="number">75</span>,<span class="number">168</span>,<span class="number">72</span>,<span class="number">218</span>,<span class="number">64</span>,<span class="number">91</span>,<span class="number">16</span>,<span class="number">101</span>,<span class="number">32</span>,<span class="number">207</span>,<span class="number">73</span>,<span class="number">130</span>,<span class="number">74</span>,<span class="number">128</span>,<span class="number">76</span>,<span class="number">201</span>,<span class="number">16</span>,<span class="number">248</span>,<span class="number">41</span>,<span class="number">205</span>,<span class="number">103</span>,<span class="number">84</span>,<span class="number">91</span>,<span class="number">99</span>,<span class="number">79</span>,<span class="number">202</span>,<span class="number">22</span>,<span class="number">131</span>,<span class="number">63</span>,<span class="number">255</span>,<span class="number">20</span>,<span class="number">16</span>]</span><br><span class="line">k = <span class="built_in">list</span>(<span class="string">b&#x27;y345&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(b)-<span class="number">4</span>,-<span class="number">1</span>,-<span class="number">1</span>):</span><br><span class="line">  k[<span class="number">1</span>],k[<span class="number">2</span>],k[<span class="number">3</span>],k[<span class="number">0</span>] = k[<span class="number">0</span>],k[<span class="number">1</span>],k[<span class="number">2</span>],k[<span class="number">3</span>]</span><br><span class="line">  r1 = b[i+<span class="number">3</span>] ^ k[<span class="number">3</span>]</span><br><span class="line">  r0 = b[i+<span class="number">2</span>] ^ k[<span class="number">2</span>]</span><br><span class="line">  r3 = b[i+<span class="number">1</span>] ^ ((k[<span class="number">1</span>]+(r1&gt;&gt;<span class="number">2</span>))&amp;<span class="number">0xff</span>)</span><br><span class="line">  r2 = b[i] ^ ((k[<span class="number">0</span>]+(r0&gt;&gt;<span class="number">4</span>))&amp;<span class="number">0xff</span>)</span><br><span class="line">  b[i],b[i+<span class="number">1</span>],b[i+<span class="number">2</span>],b[i+<span class="number">3</span>]=r0,r1,r2,r3</span><br><span class="line">  </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> b:</span><br><span class="line">  <span class="built_in">print</span>(<span class="built_in">chr</span>(i),end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"><span class="comment">#flag&#123;30831242-56db-45b4-96fd-1f47e60da99d&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="babycode"><a href="#babycode" class="headerlink" title="babycode"></a>babycode</h3><p>要装mruby，先装ruby，再装doxygen，注意把doxygen放到环境变量里，最后才能装mruby……<br>编译好之后在bin目录下可以反编译。</p>
<p><code>.\mruby -v -b .\babycode.mrb &gt; ruby.txt</code></p>
<p><del>区区三百多行，看我手撕</del><br>屮……最开始输出的字节码少了四十多行，我就说为什么没有密文密钥，而且那个check方法看起来那么奇怪……心累<br>不想再看一遍了<br>又因为运算优先级出锅了……</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> struct</span><br><span class="line">enc = <span class="string">b&#x27;f469358b7f165145116e127ad6105917bce5225d6d62a714c390c5ed93b22d8b6b102a8813488fdb&#x27;</span></span><br><span class="line">key = <span class="string">b&#x27;aaaassssddddffff&#x27;</span></span><br><span class="line">key = struct.unpack(<span class="string">&#x27;LLLL&#x27;</span>, key)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decode</span>(<span class="params">num1, num2, key</span>):</span><br><span class="line">      XX = <span class="number">0x12345678</span></span><br><span class="line">      s = XX*<span class="number">16</span></span><br><span class="line">      y = num1</span><br><span class="line">      z = num2</span><br><span class="line">      <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">        z -= (((y&lt;&lt;<span class="number">3</span>)^(y&gt;&gt;<span class="number">5</span>))+y) ^ (key[(s+<span class="number">1</span>)&amp;<span class="number">3</span>]+s)</span><br><span class="line">        z &amp;= <span class="number">0xffffffff</span></span><br><span class="line">        s -= XX</span><br><span class="line">        y -= (((z&lt;&lt;<span class="number">3</span>)^(z&gt;&gt;<span class="number">5</span>))+z) ^ (key[((s&gt;&gt;<span class="number">11</span>)+<span class="number">1</span>)&amp;<span class="number">3</span>]+s)</span><br><span class="line">        y &amp;= <span class="number">0xffffffff</span></span><br><span class="line">      <span class="keyword">return</span> struct.pack(<span class="string">&#x27;&gt;I&#x27;</span>,y), struct.pack(<span class="string">&#x27;&gt;I&#x27;</span>,z)</span><br><span class="line"></span><br><span class="line">dec = []</span><br><span class="line">b = <span class="string">b&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(enc),<span class="number">8</span>):</span><br><span class="line">  dec.append(<span class="built_in">int</span>(enc[i:i+<span class="number">8</span>],<span class="number">16</span>))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(dec),<span class="number">2</span>):</span><br><span class="line">  x,y = decode(dec[i],dec[i+<span class="number">1</span>],key)</span><br><span class="line">  b += x + y</span><br><span class="line">dec = [i <span class="keyword">for</span> i <span class="keyword">in</span> b]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(dec)):</span><br><span class="line">  l = <span class="number">0</span> <span class="keyword">if</span> i==<span class="number">0</span> <span class="keyword">else</span> dec[i-<span class="number">1</span>]</span><br><span class="line">  dec[i] ^= l ^ (i+<span class="number">1</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;&#x27;</span>.join(<span class="built_in">map</span>(<span class="built_in">chr</span>,dec)))</span><br><span class="line"><span class="comment"># flag&#123;6ad1c70c-daa4-11ec-9d64-0242ac1200&#125;</span></span><br></pre></td></tr></table></figure>

<p>参考文章：<a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/253572#h2-1">https://www.anquanke.com/post/id/253572#h2-1</a></p>

    </div>

    <div class="about">
        <h1>关于本文</h1>
        <p>本文作者 云之君, 许可由 <a
                target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc/4.0">CC BY-NC 4.0</a>.</p>
    </div>

    
        
    
</article>
        <footer>
    <div class="inner">
        <div class="links">
            
            <div class="group">
                <h4 class="title">Blog</h4>
                
                <a href="/" class="item">Blog</a>
                
                <a href="/CTF" class="item">CTF</a>
                
                <a href="/Learn" class="item">Learn</a>
                
                <a href="/Dairy" class="item">Dairy</a>
                
                <a href="/Alkaid" class="item">Alkaid</a>
                
                <a href="/friends" class="item">Friends</a>
                
            </div>
            
            <div class="group">
                <h4 class="title">Me</h4>
                
                <a target="_blank" rel="noopener" href="https://github.com/YunZh1Jun" class="item">GitHub</a>
                
                <a href="yunzh1jun@qq.com" class="item">Email</a>
                
            </div>
            
        </div>
        <span>&copy; 2022 云之君<br >驱动由 <a href="http://hexo.io/" target="_blank">Hexo</a></span>
        
            <br>
            <div class="color-scheme-toggle" role="radiogroup" id="theme-color-scheme-toggle">
                <label>
                    <input type="radio" value="light">
                    <span>Light</span>
                </label>
                <label>
                    <input type="radio" value="dark">
                    <span>Dark</span>
                </label>
                <label>
                    <input type="radio" value="auto">
                    <span>Auto</span>
                </label>
            </div>
        
    </div>
</footer>


        
<script src="/js/main.js"></script>

        
    </body>
</html>